<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="keywords" content="要买车,要买车官网,汽车电商,汽车报价,汽车团购,汽车贷款,30天无理由退车,特价新车,卜广齐,贷款买车，买新车">
	<meta name="description" content="要买车由易迅创始人及CEO、腾讯原电商副总裁卜广齐创办;提供6个月内新车,国家三包,一价到底,闪电提车,30天无理由退车,目前业务已覆盖近百个城市.消费者可自选交付、车险贷款、精品加装、上牌等服务.">
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="./css/weui.css">
	<style>
		.header {
			width: 100%;
			height: 50px;
			line-height: 50px;
			background-color: rgba(0,0,0,.9);
			text-align: center;
			color: #fff;
		}
		.weui-input {
			display: block;
			width: 90%;
			border: 1px solid #ccc;
			margin: 5px auto;
			height: 40px;
			border-radius: 5px;
			font-size: 14px;
			text-indent: 5px;
		}
		.button-wrap {
			width: 90%;
			margin: 20px auto;
		}
		.js_dialog {
			display: none;
		}
	</style>
</head>
<body>
	<div class="contenior">
		<div class="header"> 个人中心Demo</div>
		<div class="weui-calls">
			<input id="userPhone" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入号码">
			<input id="userPassword" class="weui-input" type="password" placeholder="请输入密码">
			<input id="SMSCode" class="weui-input" type="number" placeholder="请输入验证码">
			<input id="userNewPassword" class="weui-input" type="password" placeholder="请输入新密码">
		</div>

		<div class="button-wrap">
			<a href="javascript:;" id="getSMSCode" class="weui-btn weui-btn_primary">获取验证码</a>
		</div>

	</div>
	<div class="js_dialog" id="iosDialog">
			<div class="weui-mask"></div>
			<div class="weui-dialog">
					<div class="weui-dialog__bd">注册成功，快去设置密码吧~</div>
					<div class="weui-dialog__ft">
							<a href="javascript:;" id="gotoSetPassword" class="weui-dialog__btn weui-dialog__btn_primary">去设置</a>
					</div>
			</div>
	</div>
	<script src="../src/ymc.uc.js"></script>
	<script src="../lib/clientjs.js"></script>
	<script>
		(function() {
			var userPhone = document.getElementById('userPhone');
			var userCode = document.getElementById('SMSCode');
			var userPassword = document.getElementById('userPassword');
			var getSMSCode = document.getElementById('getSMSCode');
			var userLogin = document.getElementById('userLogin');
			var userPasswordLogin = document.getElementById('userPasswordLogin');
			var iosDialog = document.getElementById('iosDialog');
			var gotoSetPassword = document.getElementById('gotoSetPassword');
			var userLogout = document.getElementById('userLogout');
			var userNewPassword = document.getElementById('userNewPassword');
			var userChangePassword = document.getElementById('userChangePassword');
			var getNewAccessToken = document.getElementById('getNewAccessToken');
			var getAuthInfo = document.getElementById('getAuthInfo');
			var getTakeaAddress = document.getElementById('getTakeaAddress');
			var getCustomerInfo = document.getElementById('getCustomerInfo');

			// 获取验证码.
			getSMSCode.addEventListener('click',function() {
				var userPhoneVul = userPhone.value;
				if(!userPhoneVul) {
					console.warn('user phone is not defind');
					return;
				}
				console.log(userPhoneVul);
				userCenter.getSMSCode({
					mobile: userPhoneVul,
					useCase: 'registerOrAccess',
					strictlyCheck: true,
					success: function(data) {
						console.log(data)
					},
					error: function(error) {
						console.log(error)
					}
				});
			});

			// 快捷登录.
			userLogin.addEventListener('click',function() {
				var userPhoneVul = userPhone.value;
				var userCodeVul = userCode.value;
				if(!userPhoneVul) {
					console.warn('user phone is not defind');
					return;
				}

				if(!userCodeVul) {
					console.warn('user code is not defind');
					return;
				}
				userCenter.register({
					mobile: userPhoneVul,
					code: userCodeVul,
					useCase: "registerOrAccess",
					success: function(res) {
						var userinfo = JSON.parse(res).data;
						console.log(userinfo);
						if(userinfo.extra === 'setPassword') {
							gotoSetPassword.href = 'setPassword.html';
							iosDialog.style.display = 'block';
						}
					},
					error: function(error,xhr) {
						console.log(xhr)
					}
				});
			});

			// 密码登录.
			userPasswordLogin.addEventListener('click', function() {
				var userPhoneVul = userPhone.value;
				var userPasswordVul = userPassword.value;
				if(!userPhoneVul) {
					console.warn('user phone is not defind');
					return;
				}
				if(!userPasswordVul) {
					console.warn('user password is not defind');
					return;
				}

				userCenter.login({
					loginName: userPhoneVul,
					password: userPasswordVul,
					success: function(data) {

						console.log(data);
						alert('登录成功');
						window.location.reload();
					},
					error: function(error,xhr) {
						console.log(xhr)
					}
				});
			});

			// 退出登录.
			userLogout.addEventListener('click', function() {
				userCenter.logout({
					success: function() {
						alert('退出成功');
						window.location.reload();
					}
				})
			});

			//刷新AccessToken。
			getNewAccessToken.addEventListener('click', function() {
				var currentDate = new Date();
				var currentTime = currentDate.getTime();
				var userInfo = window.localStorage.getItem('userInfo');
				if(userInfo){
					var token = JSON.parse(userInfo).accessToken;
					var expireTime = JSON.parse(userInfo).expireTime;
				}else{
					console.warn('You are not logged in');
					return;
				}
				if(currentTime > expireTime) {
					console.warn('登录超时，请重新登录');
					return;
				}
				userCenter.newAccessToken({
					success: function(data) {
						console.log(data);
						alert('刷新成功');
						window.location.reload();
					}
				})
			});

			// 获取用户信息.
			getAuthInfo.addEventListener('click', function() {
				var currentDate = new Date();
				var currentTime = currentDate.getTime();
				var userInfo = window.localStorage.getItem('userInfo');
				if(userInfo){
					var token = JSON.parse(userInfo).accessToken;
					var expireTime = JSON.parse(userInfo).expireTime;
				}else{
					console.warn('You are not logged in');
					return;
				}
				if(currentTime > expireTime) {
					console.warn('登录超时，请重新登录');
					return;
				}
				userCenter.getAuthInfo({
					success: function(auth) {
						console.log(auth);
					}
				});
			});

			// 查询收货地址.
			getTakeaAddress.addEventListener('click', function() {
				var currentDate = new Date();
				var currentTime = currentDate.getTime();
				var userInfo = window.localStorage.getItem('userInfo');
				if(userInfo){
					var token = JSON.parse(userInfo).accessToken;
					var expireTime = JSON.parse(userInfo).expireTime;
				}else{
					console.warn('You are not logged in');
					return;
				}
				if(currentTime > expireTime) {
					console.warn('登录超时，请重新登录');
					return;
				}

				userCenter.getTakeaAddress({
					success: function(auth) {
						console.log(auth);
					}
				});
			});

			// 查询客户信息.
			getCustomerInfo.addEventListener('click', function() {
				var currentDate = new Date();
				var currentTime = currentDate.getTime();
				var userInfo = window.localStorage.getItem('userInfo');
				if(userInfo){
					var token = JSON.parse(userInfo).accessToken;
					var expireTime = JSON.parse(userInfo).expireTime;
				}else{
					console.warn('You are not logged in');
					return;
				}
				if(currentTime > expireTime) {
					console.warn('登录超时，请重新登录');
					return;
				}

				userCenter.getCustomerInfo({
					success: function(auth) {
						console.log(auth);
					}
				});

			});
		}())
	</script>
</body>
</html>
